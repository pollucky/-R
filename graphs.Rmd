
```{r setup}
knitr::opts_chunk$set(echo = TRUE)
library(causaldata)
library(ggplot2)
library(dplyr)
library(ComplexUpset)
library(ggstatsplot)
library(tidyverse)

data(close_college)
close_college
#lwage - логарифм заработной платы 
#educ - сколько лет учился 
#exper - сколько лет работал 
#black - 1 - афроамериканец 
#south - 1 - живет в южной части США 
#married - 1 - женат

#РАБОТА С ПАКЕТОМ GGPLOT2

#график №1 - график плотности распределения
ggplot(data = close_college, aes(x = lwage))+geom_density()

#настройка линии
ggplot(data = close_college, aes(x = lwage))+geom_density(color = "darkblue", size = 2, linetype="dotdash", fill = "lightblue")
#color - цвет линии
#size - размер линии
#linetype - тип линии (blank, solid, dashed, dotted, dotdash, longdash, twodash)
#fill - заливка под линией плотности распределения

#настройка темы
ggplot(data = close_college, aes(x = lwage))+geom_density(color = "darkblue", fill = "lightblue", alpha=0.4) + theme_bw()
#дополнительные темы: theme_gray, theme_linedraw, theme_light, theme_dark, theme_minimal, theme_classic, theme_void, theme_test
#alpha - прозрачность

#график №2 - распределение двух параметров: опыта и образования
#предварительно нужно сделать pivot
data <- close_college %>% pivot_longer(cols = c("educ", "exper"), values_to = "Years", names_to = "ID")
ggplot(data = data, aes(x = Years, group = ID)) + geom_density()
#подпись осей 
ggplot(data = data, aes(x = Years, group = ID)) + geom_density()+ xlab("Количество лет") + ylab("Плотность распределения")
#раскраска
ggplot(data = data, aes(x = Years, group = ID, fill = ID)) + geom_density()
#настройка собственных цветов
ggplot(data = data, aes(x = Years, group = ID, fill = ID)) + geom_density(alpha = 0.6) + scale_fill_manual(values = c("#045346", "#8DA56C"))
#цвета можно брать отсюда: https://color.romanuke.com/ 
#alpha - прозрачность цвета
#перемещение легенды вниз
ggplot(data = data, aes(x = Years, group = ID, fill = ID)) + geom_density() + theme(legend.position = "bottom")
#можно сделать facet
ggplot(data = data, aes(x = Years, group = ID, fill = ID)) + geom_density(alpha = 0.6) + scale_fill_manual(values = c("#045346", "#8DA56C")) + facet_grid(~ID) + theme(legend.position = "none")
#раскрасить цвета facet (strip.background), цвет текста в facet (strip.text)
ggplot(data = data, aes(x = Years, group = ID, fill = ID)) + geom_density(alpha = 0.6) + scale_fill_manual(values = c("#045346", "#8DA56C")) + facet_grid(~ID) + theme(legend.position = "none", strip.background =element_rect(fill="#012F2C"), strip.text = element_text(colour = 'white'))

#график №3 - распределение параметров по upset
#строится по дамми-переменным black, south, married, smsa, nearc4
dummy <- data.frame(close_college$black, close_college$south, 
                    close_college$smsa, close_college$nearc4)
colnames(dummy) <- c("black", "south", "smsa", "nearc4")
N <- names(dummy)
ComplexUpset::upset(dummy, N, name='N', width_ratio = 0.4, n_intersections  = 5, 
                    base_annotations = list('Intersection size'=intersection_size(fill='darkblue')))
#настройка цветов в UpSet
ComplexUpset::upset(dummy, N, name='N', width_ratio = 0.4, n_intersections  = 5, 
                    base_annotations = list('Intersection size'=intersection_size(fill='darkblue')), 
                    matrix=(intersection_matrix(geom=geom_point(shape='circle filled', size=3))
                      + scale_color_manual(values=c('nearc4'='#693450', 'south'='#ca540c', 'black'='#ffef03',
                                                    'smsa'='#285678'))), 
                    queries=list(upset_query(set='nearc4', fill='#693450'),
                                 upset_query(set='south', fill='#ca540c'),
                                 upset_query(set='black', fill='#ffef03'), 
                                 upset_query(set='smsa', fill='#285678')))

#график №4 - гистограммы отдельные по дамми
close_college
summary(close_college)
#сделаем pivot
data1 <- close_college %>% pivot_longer(cols = c("black", "smsa", "south", "nearc4"), values_to = "Variable", names_to = "Dummy")
data1$Variable <- as.character(data1$Variable)
#распределение по группам, position: dodge, fill
ggplot(data = data1, aes(x = Variable, fill = Dummy)) + geom_bar(position="dodge", color = "#eee4d0") + scale_fill_manual(values = c("#3c2e27", "#6d1f09", "#a05d31", "#cfa67c")) + xlab("Значение дамми-переменной") + ylab("Количество наблюдений") + theme_minimal() + theme(legend.position = "bottom")
#ВАЖНО: настройки theme ставить после настройки конкретной темы (например: theme_minimal)

#график №5 - статистически значимая корреляция
library(ggside)
ggscatterstats(
  data  = close_college,
  y     = lwage,
  x     = exper,
  ylab  = "Логарифм заработной платы",
  xlab  = "Опыт работы в годах",
  title = "Диаграмма рассеивания опыта работы и логарифма заработной платы", 
  xfill = "#018abd", 
  yfill = "#97cbdc", 
  smooth.line.args = list(size = 1.5, color = "darkblue", method = "lm", formula = y ~ x,
                          na.rm = TRUE), 
  point.args = list(size = 3, alpha = 0.4, color = "#0093b7", stroke = 0, na.rm = TRUE)
)                                                                                                                  




```





